<!--
Â©2015-2016 EdgeVerve Systems Limited (a fully owned Infosys subsidiary), Bangalore, India. All Rights Reserved.
-->
<link rel="import" href="all-imports.html">
<link rel="import" href="elements/oe-component-creator.html">
<link rel="import" href="elements/oe-component-detail.html">
<link rel="import" href="elements/oe-component-editor.html">
<link rel="import" href="elements/oe-component-footer.html">
<link rel="import" href="oe-component-redux-store.html">
<dom-module id="oe-component-manager">
    <template>
        <style>
             :host {
                position: relative;
                display: block;
                box-sizing: border-box;
                height: calc(100vh - 40px);
            }

            .component-container {
                height: 100%;
            }
        </style>
        <div class="component-container layout vertical">
            <div class="component-workspace layout horizontal flex">
                <oe-component-detail id="detail" component="{{workingComponent}}" template-containers="{{containerList}}" meta-data="{{metaData}}"
                    class="flex-3"></oe-component-detail>
                <iron-collapse horizontal class="flex-1" opened="[[showActions]]">
                    <oe-component-editor id="editor" class="flex-1" component="{{workingComponent}}" template-list="{{templateList}}" containers="[[containerList]]"
                        meta-data="{{metaData}}"></oe-component-editor>
                </iron-collapse>
            </div>
        </div>
        <oe-component-footer studio-footer hidden></oe-component-footer>
    </template>
    <script>
        Polymer({
            is: "oe-component-manager",
            properties: {
                templateList: {
                    type: Array,
                    statePath: 'templateList'
                },
                componentStack: {
                    type: Array,
                    statePath: 'componentStack'
                },
                workingComponent: {
                    type: Object,
                    statePath: 'currComponent'
                },
                stackIndex: {
                    type: Number,
                    statePath: 'stackIndex'
                }
            },
            listeners: {
                'component-updated': '_updateStack',
                'show-field-setting': '_handleFieldEdit',
                'page-selected': 'pageSelectedHandle',
                'clear-workspace':'_clearWorkSpace'
            },
            behaviors: [
                OEUtils.AjaxBehavior,
                ComponentReduxBehavior
            ],
            actions: {
                updateComponentStack: function (stack) {
                    return {
                        type: 'UPDATE_STACKLIST',
                        payload: stack
                    }
                },
                initPage: function (data) {
                    return {
                        type: 'PAGE_LOADED',
                        payload: data
                    }
                },
                clear:function(){
                    return {
                        type: 'RESET_STATE'
                    }
                }
            },
            attached: function () {
                this.set('showActions', false);
            },
            _handleFieldEdit: function (e) {
                this.$.editor.showFieldEditor(e.detail);
            },
            pageSelectedHandle: function (e) {
                var self = this;
                var comp = e.detail;
                comp.fields = comp.fields || [];
                comp.excludeFields = comp.excludeFields || [];
                this.set('showActions', true);
                this.dispatch('initPage', comp);
            },
            _updateStack: function (e) {
                this.dispatch('updateComponentStack', e.detail);
            },
            _clearWorkSpace:function(e){
                this.set('showActions', false);
                this.dispatch('clear');
            }
        })
    </script>
</dom-module>
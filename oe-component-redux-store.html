<!--
  Â©2016-2017 EdgeVerve Systems Limited (a fully owned Infosys subsidiary),
  Bangalore, India. All Rights Reserved.
-->

<script src="scripts/redux.js"></script>
<link rel="import" href="../polymer-redux/polymer-redux.html">
<script>
    var ComponentReduxBehavior = (function (Redux,PolymerRedux) {
        var initialState = {
            templateList: [],
            componentStack: [],
            stackIndex: -1,
            currComponent: null
        }
        var deepCloneJSON = function(obj){
            return JSON.parse(JSON.stringify(obj))
        }
        var _updateStackIndex = function(stackIndex,state){
            if(stackIndex < 0){
                return {
                    'stackIndex':stackIndex
                }
            }else{
                var comp = state.componentStack[stackIndex];
                return {
                    'stackIndex':stackIndex,
                    'currComponent': deepCloneJSON(comp)
                }
            }
        }
        var _updateStackList = function(data,state){
                var comp = state.componentStack;
                comp[state.stackIndex+1] = deepCloneJSON(data);
                return {
                    'stackIndex' : state.stackIndex+1,
                    'componentStack':comp,
                    'currComponent': deepCloneJSON(data)
                }
                // this.set('componentStack.' + (this.stackIndex + 1), OEUtils.deepCloneJSON(e.detail));
                // this.set('stackIndex', this.stackIndex + 1);
        }
        var _initPage = function(compData){
            var stackList = [deepCloneJSON(compData)]
            return {
                    'stackIndex':0,
                    'currComponent': deepCloneJSON(compData),
                    'componentStack':stackList
                }
        }
        var reducer = function (state, action) {
            if (!state) {
                return initialState;
            }
            var modifiedState, current, obj;
            switch (action.type) {
                case 'RESET_STATE': modifiedState = Object.assign({}, state,{
                    componentStack: [],
                    stackIndex: -1,
                    currComponent: null
                });break;
                case 'PAGE_LOADED':
                        modifiedState = Object.assign({}, state, _initPage(action.payload));
                        break;
                case 'UPDATE_TEMPLATES':
                    modifiedState = Object.assign({}, state, {
                        templateList: action.payload
                    });
                    break;
                case 'UPDATE_STACKINDEX':
                    modifiedState = Object.assign({}, state, _updateStackIndex(action.payload,state));
                    break;
                case 'UPDATE_STACKLIST':
                modifiedState = Object.assign({}, state, _updateStackList(action.payload,state));
                break;
                case 'UPDATE_CURRCOMP':
                modifiedState = Object.assign({}, state, {
                    currComponent: action.payload
                });
                break;
            }
            return modifiedState;
        }
        var store = Redux.createStore(reducer);
        return PolymerRedux(store)
    })(Redux,PolymerRedux)
</script>